<div class="container mx-auto px-4 py-8 max-w-7xl">
  <%# Header Section %>
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-6 mb-8">
    <div>
      <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Family Itinerary</h1>
      <p class="text-gray-500 mt-1">Manage meals, activities, and daily schedules.</p>
    </div>

    <div class="flex gap-3 shrink-0">
      <%= link_to new_event_path(type: 'Meal'), class: "inline-flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-4 py-2.5 rounded-xl shadow-sm font-medium transition-all hover:shadow-md hover:-translate-y-0.5" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v2H7a1 1 0 100 2h2v2a1 1 0 102 0v-2h2a1 1 0 100-2h-2V7z" clip-rule="evenodd" />
        </svg>
        <span>New Meal</span>
      <% end %>
      
      <%= link_to new_event_path(type: 'Activity'), class: "inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2.5 rounded-xl shadow-sm font-medium transition-all hover:shadow-md hover:-translate-y-0.5" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" />
        </svg>
        <span>New Activity</span>
      <% end %>
    </div>
  </div>

  <%# Heads Up Alert %>
  <% if @imminent_events.any? %>
    <div class="bg-amber-50 border-l-4 border-amber-500 p-4 mb-8 rounded-r-xl shadow-sm flex items-start gap-4 animate-fade-in-down">
      <div class="text-amber-500 shrink-0 mt-0.5">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
      </div>
      <div>
        <h3 class="font-bold text-amber-900">Heads up!</h3>
        <ul class="mt-1 space-y-1 text-amber-800">
          <% @imminent_events.each do |event| %>
            <li class="flex items-center gap-2">
              <span class="w-1.5 h-1.5 bg-amber-500 rounded-full"></span>
              <span><strong><%= event.title %></strong> is starting <%= event.start_time > Time.current ? "in #{distance_of_time_in_words(Time.current, event.start_time)}" : "now" %>!</span>
            </li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%# Toolbar: Search & Filter %>
  <div class="mb-10">
    <%= form_with url: events_path, method: :get, class: "bg-white p-1.5 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row items-stretch md:items-center gap-2" do |f| %>
      <%# Search Input Group %>
      <div class="relative flex-grow flex items-center px-3 py-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400 absolute left-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
        <%= f.text_field :query, 
            value: params[:query], 
            placeholder: "Search events...", 
            class: "w-full pl-8 pr-3 py-1 bg-transparent border-0 focus:ring-0 text-gray-900 placeholder-gray-400 text-sm focus:outline-none" %>
      </div>

      <%# Divider for desktop %>
      <div class="hidden md:block w-px h-8 bg-gray-200 my-auto"></div>

      <%# Filters %>
      <div class="flex flex-col sm:flex-row gap-2">
        <%= f.select :type, 
            [['All Types', ''], ['Meal', 'Meal'], ['Activity', 'Activity']], 
            { selected: params[:type] }, 
            class: "bg-gray-50 border-0 rounded-lg text-sm font-medium text-gray-700 py-2 pl-3 pr-8 focus:ring-2 focus:ring-gray-200 cursor-pointer hover:bg-gray-100 transition-colors" %>
        
        <%= f.select :status, 
            [['All Status', ''], ['Planned', 'planned'], ['Doing', 'doing'], ['Done', 'done']], 
            { selected: params[:status] }, 
            class: "bg-gray-50 border-0 rounded-lg text-sm font-medium text-gray-700 py-2 pl-3 pr-8 focus:ring-2 focus:ring-gray-200 cursor-pointer hover:bg-gray-100 transition-colors" %>
        
        <%= f.button type: "submit", class: "bg-gray-900 hover:bg-gray-800 text-white font-medium py-2 px-4 rounded-lg shadow-sm text-sm transition-colors flex items-center justify-center gap-2" do %>
          <span>Filter</span>
        <% end %>
      </div>
    <% end %>
  </div>

  <%# Kanban Board %>
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6" data-controller="kanban">
    <!-- Planned Column -->
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between mb-4 px-1">
        <h2 class="text-sm font-bold uppercase tracking-wider text-gray-500 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-gray-400"></span>
          Planned
        </h2>
        <span class="bg-gray-100 text-gray-600 text-xs font-semibold px-2 py-0.5 rounded-full"><%= @planned_events.count %></span>
      </div>
      <div class="bg-gray-50/50 p-2 rounded-xl border-2 border-dashed border-gray-200 flex-grow">
        <div id="planned_events" class="space-y-3 min-h-[150px]" data-kanban-target="column" data-status="planned">
          <%= render partial: "event", collection: @planned_events %>
        </div>
      </div>
    </div>

    <!-- Doing Column -->
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between mb-4 px-1">
        <h2 class="text-sm font-bold uppercase tracking-wider text-blue-600 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
          Doing / Now
        </h2>
        <span class="bg-blue-50 text-blue-700 text-xs font-semibold px-2 py-0.5 rounded-full"><%= @doing_events.count %></span>
      </div>
      <div class="bg-blue-50/30 p-2 rounded-xl border-2 border-dashed border-blue-100 flex-grow">
        <div id="doing_events" class="space-y-3 min-h-[150px]" data-kanban-target="column" data-status="doing">
          <%= render partial: "event", collection: @doing_events %>
        </div>
      </div>
    </div>

    <!-- Done Column -->
    <div class="flex flex-col h-full">
      <div class="flex items-center justify-between mb-4 px-1">
        <h2 class="text-sm font-bold uppercase tracking-wider text-emerald-600 flex items-center gap-2">
          <span class="w-2 h-2 rounded-full bg-emerald-500"></span>
          Done
        </h2>
        <span class="bg-emerald-50 text-emerald-700 text-xs font-semibold px-2 py-0.5 rounded-full"><%= @done_events.count %></span>
      </div>
      <div class="bg-emerald-50/30 p-2 rounded-xl border-2 border-dashed border-emerald-100 flex-grow">
        <div id="done_events" class="space-y-3 min-h-[150px]" data-kanban-target="column" data-status="done">
          <%= render partial: "event", collection: @done_events %>
        </div>
      </div>
    </div>
  </div>
</div>
