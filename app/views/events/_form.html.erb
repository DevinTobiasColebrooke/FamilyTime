<% 
  is_meal = event.type == "Meal"
  theme_text = is_meal ? "text-emerald-700" : "text-blue-700"
  theme_focus = is_meal ? "focus:border-emerald-500 focus:ring-emerald-500" : "focus:border-blue-500 focus:ring-blue-500"
  theme_bg = is_meal ? "bg-emerald-600 hover:bg-emerald-700 active:bg-emerald-800 focus:ring-emerald-500" : "bg-blue-600 hover:bg-blue-700 active:bg-blue-800 focus:ring-blue-500"
  theme_light_bg = is_meal ? "bg-emerald-50" : "bg-blue-50"
  theme_border = is_meal ? "border-emerald-200" : "border-blue-200"
%>

<%= form_with(model: event, local: true, class: "space-y-6") do |form| %>
  <% if event.errors.any? %>
    <div class="<%= theme_light_bg %> <%= theme_border %> border rounded-xl p-4 mb-6">
      <div class="flex">
        <div class="shrink-0">
          <svg class="h-5 w-5 <%= is_meal ? 'text-emerald-400' : 'text-blue-400' %>" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
          </svg>
        </div>
        <div class="ml-3">
          <h3 class="text-sm font-medium <%= theme_text %>"><%= pluralize(event.errors.count, "error") %> prohibited this event from being saved:</h3>
          <div class="mt-2 text-sm <%= theme_text %>">
            <ul class="list-disc list-inside space-y-1">
              <% event.errors.full_messages.each do |message| %>
                <li><%= message %></li>
              <% end %>
            </ul>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <%= form.hidden_field :type %>

  <div class="space-y-5">
    <div>
      <%= form.label :title, class: "block text-sm font-medium text-gray-700 mb-1.5" %>
      <%= form.text_field :title, 
          class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5",
          placeholder: "e.g., #{is_meal ? 'Family Dinner' : 'Soccer Practice'}" %>
    </div>

    <div>
      <%= form.label :description, class: "block text-sm font-medium text-gray-700 mb-1.5" %>
      <%= form.text_area :description, rows: 3, 
          class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5",
          placeholder: "Add any details, location, or notes..." %>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <%= form.label :start_time, class: "block text-sm font-medium text-gray-700 mb-1.5" %>
        <%= form.datetime_field :start_time, class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5" %>
      </div>

      <div>
        <%= form.label :end_time, class: "block text-sm font-medium text-gray-700 mb-1.5" %>
        <%= form.datetime_field :end_time, class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5" %>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
      <div>
        <%= form.label :cost, "Estimated Cost", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
        <div class="relative rounded-xl shadow-sm">
          <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
            <span class="text-gray-500 sm:text-sm">$</span>
          </div>
          <%= form.number_field :cost, step: "0.01", min: 0, 
              class: "block w-full rounded-xl border-gray-300 pl-7 shadow-sm #{theme_focus} sm:text-sm py-2.5", 
              placeholder: "0.00" %>
        </div>
      </div>

      <div>
        <%= form.label :status, class: "block text-sm font-medium text-gray-700 mb-1.5" %>
        <%= form.select :status, Event.statuses.keys.map { |w| [w.humanize, w] }, {}, 
            class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5" %>
      </div>
    </div>

    <% if event.new_record? %>
      <div class="bg-gray-50 rounded-xl p-4 border border-gray-100">
        <%= form.label :recurrence_rule, "Repeat", class: "block text-sm font-medium text-gray-700 mb-1.5" %>
        <%= form.select :recurrence_rule, [["Does not repeat", nil], ["Weekly (Next 4 weeks)", "weekly"], ["Monthly (Next 3 months)", "monthly"]], {}, 
            class: "block w-full rounded-xl border-gray-300 shadow-sm #{theme_focus} sm:text-sm py-2.5" %>
        <p class="mt-2 text-xs text-gray-500">Easily create multiple instances of this <%= event.type.downcase %> at once.</p>
      </div>
    <% end %>
  </div>

  <div class="pt-4 border-t border-gray-100">
    <%= form.submit class: "w-full flex justify-center py-2.5 px-4 border border-transparent rounded-xl shadow-sm text-sm font-bold text-white #{theme_bg} focus:outline-none focus:ring-2 focus:ring-offset-2 transition-colors duration-200" %>
  </div>
<% end %>
